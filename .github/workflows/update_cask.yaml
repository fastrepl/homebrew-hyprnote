on:
  repository_dispatch:
    types: [nightly_release]

jobs:
  update-cask:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: |
          VERSION="${{ github.event.client_payload.version }}"
          SHA_ARM="${{ github.event.client_payload.sha_arm }}"
          SHA_INTEL="${{ github.event.client_payload.sha_intel }}"

          cat > Casks/hyprnote@nightly.rb << EOF
          cask "hyprnote@nightly" do
            arch arm: "aarch64", intel: "x86_64"

            on_arm do
              version "$VERSION"
              sha256 "$SHA_ARM"
            end
            on_intel do
              version "$VERSION"
              sha256 "$SHA_INTEL"
            end

            url "https://desktop2.hyprnote.com/download/#{version}/dmg-#{arch}?channel=nightly"
            name "Hyprnote Nightly"
            desc "Nightly build of Hyprnote application"
            homepage "https://github.com/fastrepl/hyprnote"

            auto_updates true
            depends_on macos: ">= :sonoma"

            app "Hyprnote Nightly.app"
          end
          EOF
      - run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add Casks/hyprnote@nightly.rb
          git commit -m "Update hyprnote@nightly to ${{ github.event.client_payload.version }}"
          git push
